-# リンクのドラッグ＆ドロップでダウンロードできるウィンドウ
!!! 5
%html{:lang => "ja"}
  %head
    %meta{:charset => "utf-8"}/
    %meta{:content => "IE=edge", "http-equiv" => "X-UA-Compatible"}/
    %meta{:content => "width=device-width, initial-scale=1", :name => "viewport"}/
    %meta{:content => "whiteleaf", :name => "author"}/
    %meta{:content => "none", :name => "robots"}/
    %title Narou.rb DnD Window
    %link{:href => "//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css", :rel => "stylesheet"}/
    %link{:href => "/resources/perfect-scrollbar.min.css", :rel => "stylesheet"}/
    %link{:href => "/style.css", :rel => "stylesheet"}/
    %link{:href => "/resources/default-style.css", :rel => "stylesheet"}/
    / HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries
    /[if lt IE 9]
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  %body
    :css
      html, body, .console {
        position: relative;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #information {
        position: absolute;
        width: 100%;
        top: 50%;
        margin-top: -1em;
        text-align: center;
        color: white;
        font-size: 20px;
        font-weight: bold;
        opacity: 0.17;
        filter: alpha(opacity=17);
      }
      #drop-here {
        position: absolute;
        top: 0;
        display: inline-block;
        width: 100%;
        height: 100%;
        text-align: center;
        vertical-align: middle;
        color: white;
        font-size: 100px;
        background-color: rgba(0, 0, 0, 0.7);
      }
      #drop-here .inner {
        position: absolute;
        display: table;
        width: 95%;
        height: 95%;
        top: 2.5%;
        left: 2.5%;
        border: 6px dashed white;
      }
      #drop-here .inner .glyphicon {
        display: table-cell;
        vertical-align: middle;
      }
      #drop-cover {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: transparent;
      }

      #queue-text {
        position: absolute;
        top: 3px;
        right: 3px;
        color: white;
        margin: 0;
        padding: 0;
      }

    #console.console.fullscreen
    #information
      このウィンドウ内にダウンロードしたい<br>
      小説のリンクをドラッグ＆ドロップ
    #queue-text.navbar-text.navbar-right
      %span.glyphicon.glyphicon-inbox
      %span#queue 0
    #drop-here
      .inner
        .glyphicon.glyphicon-download-alt
      #drop-cover(effectAllowed="all")

    %script{:src => "//code.jquery.com/jquery-1.11.1.min.js"}
    %script{:src => "//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"}
    %script{:src => "/resources/perfect-scrollbar.min.js"}
    %script{:src => "/resources/narou.library.js"}
    %script{:src => "/resources/narou.queue.js"}
    :javascript
      $(document).ready(function($) {
        $("#drop-here").hide();

        var action = new Narou.Action(null);
        var notification = new Narou.Notification;
        var stream_console = new Narou.Console(notification, {
          restore: false, buttons: false
        });
        var dnd = new Narou.DragDrop;

        $(window).on("dragenter", function(e) {
          $("#drop-here").show();
        });

        $("#drop-cover")
          .on("dragover", function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = "link";
            return false;
          })
          .on("dragleave", function(e) {
            $("#drop-here").hide();
          })
          .on("drop", function(e) {
            e.preventDefault();
            dnd.getLinkText(e, function(link) {
              action.download(link);
            });
            $("#drop-here").hide();
          });
      });

