Narou.rb ― 小説家になろう読書支援アプリケーション
==================================================

説明 - Description
------------------
このアプリケーションは[小説家になろう](http://syosetu.com/)にある小説を電子書籍端末で快適に読むための支援ツールです。

全てコンソールで操作するCUIアプリケーションです。

縦書に特化しており、どんな文章だろうとほぼ違和感なく縦書で読むことが出来るでしょう。また、若干の校正機能もありますので、
小説としては許されない記述法などは矯正します。（例：感嘆符のあとにはスペースが必ずくる）

簡単にまとめると以下の様なことが出来ます。

1. 小説家になろうから小説をダウンロード
2. ダウンロードした小説の更新管理(新規投稿、改稿された既存話をダウンロード)
3. 縦書で読みやすい様にがっつり変換（校正、整形）
4. AozoraEpub3でEPUB化
5. KindlegenによるMOBI化
6. 接続されている端末に送信

１～６はすべて自動化されていて、利用者がほとんど操作をしなくても良いように設計されています。（各コマンドを使うことにより、ダウンロードのみ、変換のみ、送信のみ、なども可能です）

上で説明していない機能もまだまだあります。（更新された小説のどこが変更されたかを目視するdiffなど）

作った人 - Author
-----------------
* whiteleaf
* Twitter: https://twitter.com/sasalove7
* Blog: http://whiteleaf.hatenablog.com/
* GitHub: https://github.com/whiteleaf7/narou

必須ツール - Require tools
--------------------------
* Ruby 1.9.3 (2.0.0は動きますがまだ動作保証外です)
	* Windows: [Ruby MSI Packages](http://www.artonx.org/data/asr/), その他OS: 適当に
* [AozoraEpub3 1.1.0系](http://www18.atwiki.jp/hmdev/pages/21.html)
* Java 6以降（AozoraEpub3で必須）
* [kindlegen 2.7](http://www.amazon.com/gp/feature.html?ie=UTF8&docId=1000765211)
	* 最新版は2.8ですが、現在AozoraEpub3が吐き出すEPUBだとNCXが正常に出力されないというバグがあります。

機能っぽい一覧 - Functions
--------------------------
```
 Usage: narou <command> [arguments...] [options...]

 コマンドの簡単な説明:
   download     指定した小説をダウンロードします
   update       小説を更新します
   list         現在管理している小説の一覧を表示します
   convert      小説を変換します。管理小説以外にテキストファイルも変換可能
   diff         アップデートされた小説の変更点を表示します
   setting      各コマンドの設定を変更します
   alias        小説のIDに紐付けた別名を作成します
   inspect      小説状態の調査状況ログを表示します
   send         変換したEPUB/MOBIを電子書籍端末に送信します
   folder       小説の保存フォルダを開きます
   browser      小説の掲載ページをブラウザで開きます
   remove       小説を削除します
   freeze       小説の凍結設定を行います
   help         このヘルプを表示します
   version      バージョンを表示します
   init         AozoraEpub3 の再設定を行います

  各コマンドの詳細は narou <command> -h/--help を参照してください。
  各コマンドは先頭の一文字か二文字でも指定できます。
  (e.g. `narou d n4259s', `narou fr musyoku')
```

インストール - How to install
-----------------------------
### わかってる人向け：
```
gem install narou
```
でインストール出来ます。

*****

### 初心者向け：
必須ツールのインストールを含めて説明します。すでに導入済みの場合は読み飛ばして下さい。
ただし、AozoraEpub3 に関してだけは Narou.rb 用に別途新規インストールすることをオススメします。
それはこのアプリケーションが AozoraEpub3 用の構成ファイルを書き換えるからです。

> * Windows7ユーザを対象に説明します。他のOSの場合は適宜読み替えて下さい。
> 	* Windows以外の動作は確認していません。動作報告は歓迎いたします。
> * 3番のkindlegenのインストールはKindleを使わない方は必要ありません。

1. Ruby をインストールします。
	- [Windows用パッケージ](http://www.artonx.org/data/asr/)からインストールするのが簡単です。
	- Ruby-1.9.3-p*** Microsoft Installer Package を選びましょう。
	- インストールしたRubyにパスを通します → [参考ページ](http://www.rubylife.jp/install/install/index3.html)
2. [AozoraEpub3](http://www18.atwiki.jp/hmdev/pages/21.html) をインストールします。
	- インストールしたフォルダを覚えておきましょう。3.で必要になります。
3. [kindlegen](http://www.amazon.com/gp/feature.html?ie=UTF8&docId=1000765211) を
	AozoraEpub3 をインストールしたフォルダにコピーします。
4. Narou.rb をインストールします。コンソールを立ち上げ（Winキー+R→cmd と入力すれば立ち上がります）、
	```
	gem install narou
	```
と入力します。
5. 小説を管理するために好きな場所にフォルダを作成し、そのフォルダを初期化します。
	ここでは **C:\MyNovel** を管理用フォルダとして話を進めます。4.で立ち上げたコンソールで、
	```
	cd c:/
	mkdir MyNovel
	cd MyNovel
	narou init
	```
と順番に入力します。`narou init`を入力したら、AozoraEpub3 のフォルダの入力を求められますので、
2.でインストールしたフォルダを入力して下さい(コンソールにエクスプローラからフォルダをドラッグで入力出来ます）。
	```
	c:\MyNovel>narou init
	.narou/ を作成しました
	小説データ/ を作成しました
	------------------------------
	AozoraEpub3の設定を行います
		                          !!!WARNING!!!
	AozoraEpub3の構成ファイルを書き換えます。narouコマンド用に別途新規インストールし
	ておくことをオススメします
	
	AozoraEpub3のあるフォルダを入力して下さい
	(未入力でスキップ):
	>C:\Users\whiteleaf\Documents\GitHub\narou\AozoraEpub3
	
	(次のファイルを書き換えました)
	～～ 以下略 ～～
	```

これで **C:\MyNovel** 以下のフォルダでNarou.rbの各種コマンドが使用できるようになります。

使い方 - How to use
-------------------
基本的な使い方を説明します。

*****

### 小説のダウンロード (download)

ここでは[無職転生　- 異世界行ったら本気だす -](http://ncode.syosetu.com/n9669bk/)を例に説明します
（関係ないですが私のオススメ小説です）。また、使用している電子書籍端末を **Kindle Paperwhite** と仮定します。

以下は全てコンソールでの作業です。

1. まずは Kindle Paperwhite をUSBケーブルでパソコンに接続します。
2. あなたの使用する電子書籍端末を設定します。ここでは Kindle Paperwhite なので、
	```
	narou setting device=kindle
	```
	
	と入力します。
3. 小説をダウンロードしましょう！　次のコマンドを入力して下さい。
	```
	narou download n9669bk
	```
	
	小説のダウンロードが始まるので終わるまで待ちます。
	
	> *NOTICE*
	> - `narou download` は `narou d` と省略することが出来ます。
	> - `narou d http://ncode.syosetu.com/n9669bk/` とURLを直接入力することもできます。
	> ブラウザからそのままコピーが楽でしょう（アドレスバーのアイコンをドラッグで入力出来ます）。
4. 自動で変換されます。
5. Kindle Paperwhiteへコピーされましたね？ **これでもうKindle Paperwhiteで読むことが出来ます！**
	
	このアプリケーションは **ダウンロード→変換→端末へ送信** までが全自動なのです。
	> *NOTICE*
	> 
	> ダウンロード時の変換は抑制することが出来ます。
	> 
	> `narou d n9669bk -n` と `-n` オプションをつければダウンロードだけ実行します。

*****

### ダウンロードした小説の管理

一度小説をダウンロードすれば、パソコン上に保存され、次回以降は再度ダウンロードする必要はありません。

まずは現在保存されている小説の一覧を見てみましょう。

#### 一覧を表示する (list)
```
narou list
  ID |  更新日  |     タイトル
   0 | 13/02/26 | 無職転生　- 異世界行ったら本気だす -
```
先ほどダウンロードした無職転生がリストに現れました。 **listコマンド** では現在管理している小説の一覧を表示することが出来ます。

このlistコマンドは非常によく使いますので、`narou l` (l は小文字のエル)と短縮コマンドを覚えましょう。短縮コマンドは各コマンドの頭文字の１文字、もしくは２文字を使います。

このリストで表示されているIDは、各コマンドで小説を特定するための数字です。
NコードやURL、タイトルでも各コマンドは動かすことが出来ますが、入力が面倒なのでIDを使いましょう。

#### 小説を更新する (update)
```
narou update
無職転生　- 異世界行ったら本気だす - に更新はありません
```
ダウンロードしたばかりなので更新は当然ありませんね。この **updateコマンド** は、現在管理している全ての小説の更新をチェックするコマンドです。これもまたよく使うコマンドなので、`narou u` という短縮コマンドを覚えましょう。

updateコマンドは指定した小説のみアップデートする機能もあります。
```
narou update 0
```
と先ほどlistコマンドで取得したIDをupdateに続いて指定しました。これで無職転生のみの更新を取得することが出来ます。

（ここまで書いた）

#### 読み終わったら評価、感想を書こう

小説家になろうの作品を読んだら評価や感想を書きましょう。

```
narou browser 0 --vote
```
ブラウザが開き、評価投票、感想を書くページが表示されます。--vote オプションを付けなかった場合は目次ページが表示されます。

サポート - Support
------------------
https://twitter.com/sasalove7 , http://whiteleaf.hatenablog.com/

上記のツイッター及びブログで今後要望等を取り扱いたいと思います。

動作環境 - Platform
-------------------

### OS別動作状況

|OS名           |Rubyバージョン|動作|備考                                  |
|---------------|--------------|:--:|--------------------------------------|
|Windows7 64 bit|Ruby 1.9.3    | ◎ |製作者と同じ環境                      |
|Windows7 64 bit|Ruby 1.9.2    | × |1.9.2には対応していません             |
|WindowsXP      |Ruby 1.9.3    | ◎ |                                      |
|Windows7 64 bit|Ruby 2.0.0    | ○ |動くが一部ライブラリで警告が出る      |
|Mac OS X       |Ruby x.x.x    | ？ |                                      |
|Linux          |Ruby x.x.x    | ？ |                                      |

> ◎：動作確認済み、○：動くが動作未確認か一部に何か問題あり、△：多分動くかも、×：動きません、？：動作未確認

send コマンドに関しては現在 Windows 専用となっております。要望と情報があれば対応します。

### 端末の自動認識での対応リスト

|電子書籍端末名      |対応状況|備考                                                          |
|--------------------|:------:|--------------------------------------------------------------|
|Kindle Paperwhite   |   ◎   |表示の確認も動作確認も済。この端末を元にチューニングしています|
|Kindle Fire         |   △   |動くかもしれませんが未確認                                    |
|Kobo シリーズ       |   △   |情報を元に設定してありますが、動作未確認です。多分動きます    |
|Sony Reader シリーズ|   ？   |情報が全くありません                                          |
|他各種端末/アプリ   |   ？   |USBにつながるタイプならまだ望みはあります                     |

Kobo については暫定で対応しておりますが、動作未確認です。
Kindle Paperwhite 以外の環境の対応については、以下の情報があれば対応可能です。(Windowsの場合)
- USB接続した場合のボリュームラベル
- 書籍データを保存するフォルダ名
- 対応電子書籍データの種類(.epubかどうか等)

出力したEPUBを手動でコピーする分には動作対応などは全く関係は無いです。

添付のDMincho.ttfについて - About DMincho font
----------------------------------------------
WEB小説でよく見かける「あ゛」のような表現を、縦書でも再現するための濁点つきフォントです。

青キン明朝フォントをカスタマイズして使用しています。

オリジナルはIPA明朝フォントであり、ライセンスは **IPAフォントライセンスv1.0** の元に「派生プログラム」として
再配布されています。

ライセンスに基づく一般公開は以下のURLになります。また、
オリジナルなIPA明朝フォントに戻す場合、下記からDL出来るアーカイブに同梱の ipam.otf で上書きして下さい。

http://ux.getuploader.com/whiteleaf/download/23/ipam.rar

更新履歴 - ChangeLog
--------------------

1.0.2 : 2013/02/24
 - フォントのライセンスについて明確に記載した

1.0.1 : 2013/02/24
 - folder コマンドが正常に機能していないバグを修正

1.0.0 : 2013/02/24
 - first release

